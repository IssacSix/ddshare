[TOC]

## JSå†…å­˜æ³„æ¼çš„åŸå› åŠè¯†åˆ«

### æ¦‚è¿°ï¼šä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼

ç¨‹åºçš„è¿è¡Œéœ€è¦å†…å­˜ï¼Œåªè¦ç¨‹åºæå‡ºè¦æ±‚ï¼Œæ“ä½œç³»ç»Ÿè¿è¡Œæ—¶å°±å¿…é¡»è¦åˆ†é…å†…å­˜ã€‚å¯¹äºæŒç»­è¿è¡Œçš„è¿›ç¨‹ï¼Œå¿…é¡»åŠæ—¶é‡Šæ”¾æ²¡ç”¨çš„å†…å­˜ï¼Œå¦åˆ™å†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œå½±å“ç³»ç»Ÿè¿è¡Œæˆ–è€…ç›´æ¥å¥”æºƒã€‚

**å¯¹äºæ²¡æœ‰å†ç”¨åˆ°çš„å†…å­˜ï¼Œæ²¡æœ‰åŠæ—¶é‡Šæ”¾ï¼Œå°±å«åšå†…å­˜æ³„æ¼**



### ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶

å†…å­˜å¯ä»¥æ‰‹åŠ¨æ¸…ç†ï¼Œä½†æ˜¯å¾ˆå¤šè¯­è¨€éƒ½æä¾›å†…å­˜è‡ªåŠ¨ç®¡ç†ï¼Œç®€åŒ–ç®¡ç†å†…å­˜çš„ä»£ç ï¼Œè¿™å°±è¢«ç§°ä¸º **åƒåœ¾å›æ”¶æœºåˆ¶**

#### åƒåœ¾å›æ”¶æœºåˆ¶å¦‚ä½•å¾—çŸ¥å·²ä¸å†éœ€è¦çš„å†…å­˜ï¼Ÿ

1. **å¼•ç”¨è®¡æ•°æ³•**

   è¿™æ˜¯ä¸€ç§æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚è¯­è¨€å¼•æ“æœ‰ä¸€å¼ â€œå¼•ç”¨è¡¨â€ï¼Œä¿å­˜äº†å†…å­˜ä¸­æ‰€æœ‰çš„å€¼çš„å¼•ç”¨æ¬¡æ•°ï¼Œå½“æŸä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°ä¸º0ï¼Œå°±è¡¨ç¤ºè¿™ä¸ªå€¼å·²ç»æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œå¯ä»¥è¢«é‡Šæ”¾äº†ã€‚



#### V8 åƒåœ¾å›æ”¶æœºåˆ¶



### å¯¼è‡´å†…å­˜æ³„éœ²çš„æƒ…å†µåŠå¤„ç†

#### æƒ…å†µ1

æŸä¸ªå€¼æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œä½†æ˜¯å¼•ç”¨æ¬¡æ•°ä¸ä¸º0

```
var arr = [1,2]
console.log('i am dingding')
```

 å°½ç®¡ arrè¿™ä¸ªå˜é‡æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œä½†æ˜¯arrçš„å¼•ç”¨æ¬¡æ•°ä¸º1ï¼Œæ‰€ä»¥ä¾ç„¶ä¼šå ç”¨å†…å­˜ï¼Œå¦‚ä½•è§£é™¤ï¼Ÿ

é˜®å¤§å¤§ä¸¾äº†è¿™ä¹ˆä¸€ä¸ªğŸŒ°

```
var arr = [1,2]
console.log('i am dingding')
arr = null
```

arr è¢«é‡ç½®ï¼Œè§£é™¤äº†å¯¹[1,2]çš„å¼•ç”¨ï¼Œå¼•ç”¨æ¬¡æ•°å°±å˜æˆäº†0ï¼Œå†…å­˜å°±å¯ä»¥è¢«é‡Šæ”¾äº†ã€‚å› æ­¤ï¼Œå¹¶ä¸æ˜¯è¯´æœ‰äº†åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œæˆ‘ä»¬å°±è½»æ¾äº†ã€‚ä½ è¿˜æ˜¯éœ€è¦å…³æ³¨å†…å­˜å ç”¨ï¼Œå¯¹é‚£äº›å¾ˆå ç©ºé—´çš„å€¼ï¼Œä¸€æ—¦ä¸å†ç”¨åˆ°ï¼Œä½ å°±éœ€è¦æ£€æŸ¥æ˜¯å¦è¿˜å­˜åœ¨å¯¹å®ƒä»¬çš„å¼•ç”¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œå°±å¿…é¡»æ‰‹åŠ¨è§£é™¤å¼•ç”¨ã€‚

**ä»¥ä¸Šçš„ä¼ªä»£ç ï¼Œå®é™…æƒ…å†µä¸­ï¼Œå‡ºç°çš„å¯èƒ½æ€§å¾ˆå°å¾ˆå°ï¼Œä¸ºä»€ä¹ˆï¼Ÿ** ä¸ä»…æ˜¯é˜®å¤§å¤§ä¸¾è¿‡è¿™ä¸ªä¾‹å­ï¼Œåœ¨ã€Šjsé«˜çº§ç¨‹åºè®¾è®¡ã€‹ä¸­æœ‰ä¸€ä¸ªç« èŠ‚ä¹Ÿå‡ºç°è¿‡ï¼Œä½†æ˜¯å¯¹äºå‰ç«¯å°èœé¸Ÿæ¥è¯´ï¼Œå…¶å®è¿™ä¸ªæ —å­å®ä¸ºä¸å¦¥ï¼ŒåŸå› ï¼š

1. all = null ï¼Ÿè™½ç„¶ç†è®ºä¸Šæ¥è¯´ï¼Œå¯è¡Œï¼Œä½†æ˜¯å®é™…ç¼–ç¨‹ä¸­ä¸åº”è¯¥æ˜¯é€šè¿‡è¿™ç§æ“ä½œæ‰‹åŠ¨æ¸…é™¤ï¼Œä¸€èˆ¬çš„ç¼–ç¨‹è§„èŒƒä¹Ÿä¸ä¼šå…è®¸ä½ è¿™ä¹ˆå»å†™ã€‚å»å‘çš„è¿™å‡ å¹´ï¼Œè¿™ç§ä»£ç æˆ‘æ˜¯ä¸€è¡Œéƒ½æ²¡å†™è¿‡ï¼Œå› ä¸ºæˆ‘ä¸çŸ¥é“è¦æ¸…é™¤å†…å­˜ã€‚ã€‚ã€‚
2. arr æ˜¯ä¸ªå…¨å±€å˜é‡ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹æˆ‘ä»¬çœŸçš„éœ€è¦å®šä¹‰ä¸€ä¸ªå˜é‡åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ï¼Ÿå¾€å¾€æ˜¯ç¼–ç¨‹ä¹ æƒ¯çš„ä¸å¦¥
3. ä¸€èˆ¬å†…å­˜æ³„æ¼çš„æƒ…å†µï¼Œå¤§å¤šæ˜¯åœ¨é—­åŒ…ä¸­ï¼Œå‡½æ•°æ‰§è¡Œå®Œï¼Œä½†æ˜¯å†…éƒ¨å˜é‡ä¾ç„¶ç•™åœ¨å†…å­˜ä¸­ï¼Œè¿™å°±é€ æˆäº†å†…å­˜æ³„æ¼ï¼

#### æƒ…å†µ2:  æ„å¤–çš„å…¨å±€å˜é‡

```
function fun () {
  bar = "this is a hidden global variable" 
}
```

```
function fun () {
  this.bar = "potential accident global"
}
fun () // this æŒ‡å‘window æ„å¤–åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€å˜é‡
```

#### å¤„ç†ï¼š

jsæ–‡ä»¶å¤´éƒ¨æ·»åŠ 'use strict' å¼€å¯ä¸¥æ ¼æ¨¡å¼è§£æjsï¼Œé¿å…åˆ›å»ºæ„å¤–çš„å…¨å±€å˜é‡



####æƒ…å†µ3:  è„±ç¦»DOMçš„å¼•ç”¨





#### æƒ…å†µ4:  é—­åŒ…ä¼šå¼•èµ·å†…å­˜æ³„æ¼ä¹ˆ







### å†…å­˜æ³„éœ²çš„è¯†åˆ«æ–¹æ³•

1. chrome æµè§ˆå™¨

   ```
   1. æ‰“å¼€æ§åˆ¶å°
   2. ç‚¹å‡»Memory
   3. å‹¾é€‰Record allocation timeline
   ```

2. å‘½ä»¤è¡Œ

   â€‹

### é¿å…å†…å­˜æ³„æ¼çš„æ–¹æ³•

å¤§é‡å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œéƒ½éœ€è¦æ‰‹åŠ¨æ¸…é™¤ï¼Œæ˜¯ååˆ†éº»çƒ¦çš„ï¼Œé‚£ä¹ˆæœ‰å’©æœ‰ä¸€ç§å¼•ç”¨ç”³æ˜å¯ä»¥è®©åƒåœ¾å›æ”¶æœºåˆ¶ä¸è€ƒè™‘è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œå½“å…¶ä»–å¯¹è±¡éƒ½ä¸å†å¼•ç”¨è¯¥å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶å°±å¯è‡ªåŠ¨å›æ”¶äº†ï¼Œæ‰€ä»¥ä¸»è¦æ¸…æ¥šä¸»è¦çš„å¼•ç”¨å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚

**æœ‰çš„ï¼**

ES6è€ƒè™‘åˆ°äº†è¿™ç‚¹ï¼Œæ¨å‡ºä¸¤ç§æ–°çš„æ•°æ®ç»“æ„ weakSet WeakMap,å®ƒä»¬çš„å¯¹äºå€¼çš„å¼•ç”¨å°±æ˜¯ä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶

#### WeakSet

1. WeakSet æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•° é€šè¿‡new åˆ›å»º

2. æˆå‘˜ç±»å‹åªå…è®¸æ˜¯ => å¯¹è±¡

   ```
   const a = [[1, 2], [3, 4]];
   const ws = new WeakSet(a);
   // WeakSet{[1, 2], [3, 4]}

   const b = [3, 4];
   const ws = new WeakSet(b);
   // Uncaught TypeError: Invalid value used in weak set(â€¦)
   ```

   æ•°ç»„bçš„æˆå‘˜ä¸ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥æŠ¥é”™

3. weakSet æ–¹æ³•

   * **WeakSet.prototype.add(value)**ï¼šå‘ WeakSet å®ä¾‹æ·»åŠ ä¸€ä¸ªæ–°æˆå‘˜ã€‚
   * **WeakSet.prototype.delete(value)**ï¼šæ¸…é™¤ WeakSet å®ä¾‹çš„æŒ‡å®šæˆå‘˜ã€‚
   * **WeakSet.prototype.has(value)**ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªå€¼æ˜¯å¦åœ¨ WeakSet å®ä¾‹ä¹‹ä¸­ã€‚

#### WeakMap

ç±»ä¼¼WeakSet(æ„Ÿè§‰å®é™…ç”¨å¤„å¹¶ä¸å¤§ï¼Œæˆ‘çœŸçš„æ‡’å¾—å†™äº† : )



### å‚è€ƒèµ„æ–™

1. [ã€Šé˜®å¤§å¤§ å†…å­˜æ³„æ¼æ•™ç¨‹ã€‹](http://www.ruanyifeng.com/blog/2017/04/memory-leak.html?utm_source=tuicool&utm_medium=referral/*&^%$)
2. [ã€Š4ç±»jså†…å­˜æ³„æ¼ã€‹](https://jinlong.github.io/2016/05/01/4-Types-of-Memory-Leaks-in-JavaScript-and-How-to-Get-Rid-Of-Them/)

