# 前端性能优化

### 两个出发点	=> 	技术优化出发点.xmind	

1. 复用（解耦）
2. 加载方式（提升用户体验）
   1. 同步加载
   2. 分级加载
   3. 按需加载



### 优化的四个层面  => 页面访问流程.xmind

1. 基础性能
2. 网络层面
3. 加载顺序
4. 本地存储



#### 前端基础性能优化

1. DOM优化：尽量避免直接操作真实DOM，实在需要操作，优化点：

   1. 增加节点：多节点insert 创建碎片后统一插入，避免多次的reflow
   2. 修改节点：使用cloneNode 在外部更新节点，然后replace原始节点
   3. 优化css样式转化：修改多条样式，替换className，减少reflow次数
   4. 减少DOM数量：正常页面DOM数量不能超过1000个
   5. 尽可能使用速度更快的API,比如querySelectorAll
   6. 使用事件委托来减少事件的处理器的数量
   7. 留意重绘跟重排

2. repain reflow：分析发生的场景，做相应的优化，减少reflow

   1. 改变窗体大小
   2. 更改字体
   3. 添加删除样式块
   4. 内容改变哪怕是输入框的文字
   5. css伪类触发
   6. 更改className
   7. DOM发生增删
   8. 动态设置一个style样式
   9. 获取需要经过计算的尺寸

3. HTML优化

   1. 避免空src、 href
   2. 合理架构，尽量使DOM结构简单
   3. 利用预加载优化资源（CMD,AMD img等）
   4. 利用localStorage合理缓存资源
   5. 使用web Worker来允许多线程工作（没用过）

4. js 载入优化

   1. CMD AMD设置加载顺序，确保依赖的完整性
   2. 适当使用CDN
   3. 尾部加入，避免阻塞html解析
   4. 设置Cahe-Control Expires

5. 内存专题

   1. js 垃圾回收机制：V8 对内存中的js进行分代管理
      1. 新生代：新生代即存活周期较短的sj，临时变量、字符串等
      2. 老生代：经过多次垃圾回收仍然存活，存活周期较长的对象
   2. 垃圾回收算法
   3. 对象进行回收
   4. ie下闭包引起跨页面的内存泄漏
   5. 内存泄漏处理

6. 变量专题

   1. 使用模块化，避免变量全局污染
   2. 合理使用闭包，优化内存，优化垃圾回收

7. 对象专题

   1. 减少不必要的对象创建：减少开销，优化垃圾回收，尽量用json创建对象
   2. 对象查找

8. 作用域链、闭包优化

   1. 减少作用域链上的查找次数

   2. 良好的闭包管理

   3. 避开闭包陷阱，避免内存的泄漏

   4. 善用函数，使用匿名函数，在外层进行包裹（模块化）

      ```
       (function(win, doc, $, undefined) {
            // 主业务代码
          })();
          
      在逻辑代码外包装一层函数，当UI渲染完成之后，代码对data的引用也就随之解除，而在最外层函数执行完毕时，js引擎就开始对其中的对象进行检查，data也就可以随之被回收。
      ```

9. 代码压缩

   1. 压缩工具
   2. gzip

10. 服务端优化

  1. 避免404
  2. 删除重复的静态资源文件
  3. 权衡DNS查找的次数
  4. 通过keep-alive减少TCP的连接
  5. 平行处理请求（bigpipe）
  6. 合并文件 减少http请求
  7. 减少重定向



